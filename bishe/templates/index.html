{% extends "base.html" %}
{% block title %}홈 - 캠퍼스 분실물 센터{% endblock %}

{% block content %}

<!-- Hero Banner -->
<div class="card" style="border:none; padding:0;">
  <div style="
    background: linear-gradient(135deg,#3b82f6 0%,#6366f1 50%,#8b5cf6 100%);
    border-radius: 14px;
    padding: 2.2rem 2rem;
    color: #fff;">
    <div style="display:grid; grid-template-columns: 1.2fr 1fr; gap:1.5rem; align-items:center;">
      <div>
        <div style="opacity:.95; font-weight:700; letter-spacing:.5px;">CAMPUS LOST & FOUND</div>
        <h2 style="font-size:2.2rem; line-height:1.25; margin:.35rem 0 0.6rem;">
          캠퍼스 분실물, 빠르고 안전하게 찾으세요
        </h2>
        <p style="opacity:.92; line-height:1.8;">
          분실 · 습득 정보를 간편하게 등록하고 검색하세요. 종류/위치별 통계와
          AI 도우미가 더 빠른 찾기를 도와드립니다.
        </p>
        <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:1rem;">
          <a href="/search" class="btn" style="background: rgba(255,255,255,.2); color:#fff;">🔎 분실물 검색</a>
          <a href="/register" class="btn btn-secondary">📝 정보 등록</a>
          <a href="/ai" class="btn" style="background: rgba(255,255,255,.2); color:#fff;">🤖 AI 도우미</a>
        </div>
      </div>
      <div>
        <div style="background: rgba(255,255,255,.15); border:1px solid rgba(255,255,255,.25);
                    border-radius: 14px; padding:1rem;">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem;">
            <div style="background:#fff; color:#111; border-radius:12px; padding:1rem; text-align:center;">
              <div style="font-size:1.8rem;">🔍</div>
              <div style="margin-top:.35rem; font-weight:700;">분실 신고</div>
              <div style="font-size:.85rem; color:#666;">특징/위치 자세히</div>
            </div>
            <div style="background:#fff; color:#111; border-radius:12px; padding:1rem; text-align:center;">
              <div style="font-size:1.8rem;">📦</div>
              <div style="margin-top:.35rem; font-weight:700;">습득 신고</div>
              <div style="font-size:.85rem; color:#666;">안전 보관 권장</div>
            </div>
            <div style="background:#fff; color:#111; border-radius:12px; padding:1rem; text-align:center;">
              <div style="font-size:1.8rem;">🗂️</div>
              <div style="margin-top:.35rem; font-weight:700;">종류/장소</div>
              <div style="font-size:.85rem; color:#666;">정확히 선택</div>
            </div>
            <div style="background:#fff; color:#111; border-radius:12px; padding:1rem; text-align:center;">
              <div style="font-size:1.8rem;">📞</div>
              <div style="margin-top:.35rem; font-weight:700;">연락처</div>
              <div style="font-size:.85rem; color:#666;">연락 가능한 채널</div>
            </div>
          </div>
        </div>
      </div>
    </div>  
  </div>
</div>

<!-- Quick Actions + 공지 -->
<div style="display:grid; grid-template-columns: 1.2fr 1fr; gap:1rem;">
  <!-- Quick Actions -->
  <div class="card">
    <h3 style="color:#2c3e50; margin-bottom:1rem;">빠른 시작</h3>
    <form method="GET" action="/search" style="display:grid; grid-template-columns: 2fr 1fr 1fr auto; gap:.75rem;">
      <div class="form-group" style="margin:0;">
        <label for="keyword">키워드</label>
        <input class="form-control" id="keyword" name="keyword" placeholder="물품명/장소/특징 입력">
      </div>
      <div class="form-group" style="margin:0;">
        <label for="category">종류</label>
        <select class="form-control" id="category" name="category">
          <option value="">전체</option>
          {% if categories %}
            {% for c in categories %}
              <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </div>
      <div class="form-group" style="margin:0;">
        <label for="type">구분</label>
        <select class="form-control" id="type" name="type">
          <option value="all">전체</option>
          <option value="lost">분실</option>
          <option value="found">습득</option>
        </select>
      </div>
      <div style="display:flex; align-items:flex-end;">
        <button type="submit" class="btn">검색</button>
      </div>
    </form>

    <!-- chips -->
    <div style="margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
      {% if categories %}
        {% for c in categories %}
          <a class="btn" href="/search?category={{ c }}" style="padding:.45rem .9rem; font-size:.9rem;">
            # {{ c }}
          </a>
        {% endfor %}
      {% endif %}
      {% if locations %}
        {% for l in locations[:6] %}
          <a class="btn btn-secondary" href="/search?keyword={{ l }}" style="padding:.45rem .9rem; font-size:.9rem;">
            📍 {{ l }}
          </a>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <!-- Announcements -->
  <div class="card">
    <h3 style="color:#2c3e50; margin-bottom:.75rem;">공지사항</h3>
    <div style="display:grid; gap:.6rem;">
      <div style="background:#f8f9fa; border-radius:10px; padding:.9rem;">
        <strong>분실/습득 등록 시</strong> 색상·브랜드·특징(스크래치/키링 등)을 자세히 남겨주세요.
      </div>
      <div style="background:#f8f9fa; border-radius:10px; padding:.9rem;">
        <strong>안전한 인계</strong>를 위해 공공장소에서 만나고, 신원 확인을 진행해주세요.
      </div>
      <div style="background:#f8f9fa; border-radius:10px; padding:.9rem;">
        연락처는 <strong>오픈채팅/이메일</strong> 등 2차 채널을 권장합니다.
      </div>
    </div>
  </div>
</div>

<!-- 최신 등록 -->
<div class="card">
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom: .75rem;">
    <h3 style="color:#2c3e50;">최신 등록</h3>
    <a href="/search" class="btn btn-secondary" style="padding: .45rem .9rem;">전체 보기</a>
  </div>

  {% if items_recent and items_recent|length > 0 %}
  <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:1rem;">
    {% for item in items_recent %}
      <div style="border:1px solid #eef; border-radius:12px; padding:1rem; background:#fff;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem;">
          <div style="font-size:.85rem; padding:.25rem .6rem; border-radius:999px;
               {% if item.type_class == 'lost' %} background: #ffe8ea; color:#b4232a;
               {% else %} background: #e7fbef; color:#1e7e34; {% endif %}">
            {{ item.type }}
          </div>
          <div style="color:#999; font-size:.85rem;">{{ item.created_at }}</div>
        </div>
        <div style="font-weight:700; color:#2c3e50; margin-bottom:.35rem;">
          {{ item.name }}
        </div>
        <div style="display:grid; gap:.25rem; font-size:.95rem; color:#555;">
          <div>📂 종류: <strong>{{ item.category }}</strong></div>
          <div>📍 위치: <strong>{{ item.place }}</strong></div>
          <div>📅 일자: <strong>{{ item.date }}</strong></div>
        </div>
        {% if item.description %}
          <div style="margin-top:.6rem; font-size:.9rem; color:#666; background:#f8f9fa; padding:.6rem; border-radius:8px;">
            {{ item.description }}
          </div>
        {% endif %}
        {% if item.contact %}
          <div style="margin-top:.6rem; text-align:right;">
            <a class="btn" style="padding:.4rem .8rem; font-size:.9rem;" href="javascript:void(0)" onclick="showContact('{{ item.contact }}')">연락하기</a>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div style="text-align:center; color:#666; padding:1rem 0;">
      아직 등록된 내역이 없습니다. 첫 번째로 등록해 보세요! 😊
      <div style="margin-top:.8rem;">
        <a href="/register" class="btn">분실/습득 등록하기</a>
      </div>
    </div>
  {% endif %}
</div>

<!-- 도움말 / 가이드 -->
<div class="card">
  <h3 style="color:#2c3e50; margin-bottom:1rem;">이용 가이드</h3>
  <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:.9rem;">
    <div style="background:#f7f9ff; border-radius:10px; padding:1rem;">
      <strong>① 먼저 검색</strong>
      <p style="color:#666; margin-top:.35rem;">이미 등록된 유사 물품이 있는지 확인하세요.</p>
    </div>
    <div style="background:#f7f9ff; border-radius:10px; padding:1rem;">
      <strong>② 상세 등록</strong>
      <p style="color:#666; margin-top:.35rem;">색상·브랜드·특징을 최대한 자세히 적어주세요.</p>
    </div>
    <div style="background:#f7f9ff; border-radius:10px; padding:1rem;">
      <strong>③ 안전 보관</strong>
      <p style="color:#666; margin-top:.35rem;">습득물은 안전하게 보관하며 연락을 기다립니다.</p>
    </div>
    <div style="background:#f7f9ff; border-radius:10px; padding:1rem;">
      <strong>④ 안전 인계</strong>
      <p style="color:#666; margin-top:.35rem;">공공장소에서 만나고 신원을 확인한 후 인계하세요.</p>
    </div>
  </div>
</div>

<!-- 연락 모달 -->
<div id="contactModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
                              background:rgba(0,0,0,.45); z-index:1000;">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
              background:#fff; padding:1.5rem; border-radius:12px; width:92%; max-width:420px;">
    <h3 style="margin-bottom:.75rem; color:#2c3e50; text-align:center;">연락처</h3>
    <div style="background:#f8f9fa; border-radius:10px; padding:1rem; text-align:center;">
      <div style="font-size:2rem; margin-bottom:.35rem;">📞</div>
      <div id="contactInfo" style="font-size:1.05rem; font-weight:700; color:#667eea;"></div>
    </div>
    <div style="text-align:center; margin-top:1rem;">
      <button class="btn" onclick="closeContact()">닫기</button>
    </div>
  </div>
</div>

<script>
  function showContact(text) {
    var el = document.getElementById('contactInfo');
    el.textContent = text;
    document.getElementById('contactModal').style.display = 'block';
  }
  function closeContact() {
    document.getElementById('contactModal').style.display = 'none';
  }
  document.getElementById('contactModal').addEventListener('click', function(e){
    if (e.target === this) closeContact();
  });
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') closeContact();
  });
</script>

{% endblock %}

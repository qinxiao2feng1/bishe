{% extends "base.html" %}

{% block title %}정보 등록 - 캠퍼스 분실물 플랫폼{% endblock %}

{% block content %}
<div class="page-title">
    <h2>정보 등록</h2>
    <p>물품 정보를 자세히 작성해 주세요. 더 빠른 회수에 도움이 됩니다 📝</p>
</div>

<div style="max-width: 800px; margin: 0 auto;">
    <div class="card">
        <form method="POST" action="/register">
            <!-- 물품 상태 선택 -->
            <div class="form-group">
                <label>물품 상태 *</label>
                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                    <label style="display: flex; align-items: center; cursor: pointer;
                                  padding: 12px 20px; border: 2px solid #e3e8f0;
                                  border-radius: 10px; transition: all 0.3s ease;">
                        <input type="radio" name="item_type" value="lost" required
                               style="margin-right: 8px;" onchange="updateFormTitle()">
                        <span style="font-weight: 500;">🔍 물건을 잃어버렸어요</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer;
                                  padding: 12px 20px; border: 2px solid #e3e8f0;
                                  border-radius: 10px; transition: all 0.3s ease;">
                        <input type="radio" name="item_type" value="found" required
                               style="margin-right: 8px;" onchange="updateFormTitle()">
                        <span style="font-weight: 500;">📦 물건을 주웠어요</span>
                    </label>
                </div>
            </div>

            <div id="form-title" style="text-align: center; margin: 2rem 0;
                                        padding: 1rem; background: #f8f9fa;
                                        border-radius: 10px; display: none;">
                <h3 id="title-text" style="color: #667eea;"></h3>
            </div>

            <!-- 물품 정보 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="name">물품명 *</label>
                    <input type="text" id="name" name="name" class="form-control"
                           placeholder="예: 검정 지갑, iPhone 휴대폰" required>
                </div>

                <div class="form-group">
                    <label for="category">물품 종류 *</label>
                    <select id="category" name="category" class="form-control" required>
                        <option value="">종류를 선택하세요</option>
                        {% for category in categories %}
                            <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="place">장소 *</label>
                    <select id="place" name="place" class="form-control" required>
                        <option value="">장소를 선택하세요</option>
                        {% for location in locations %}
                            <option value="{{ location }}">{{ location }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="date" id="date-label">날짜 *</label>
                    <input type="date" id="date" name="date" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label for="contact">연락처</label>
                <input type="text" id="contact" name="contact" class="form-control"
                       placeholder="예: 카톡 ID, 이메일, 전화번호(연락 편의를 위해 권장)">
            </div>

            <div class="form-group">
                <label for="description">상세 설명</label>
                <textarea id="description" name="description" class="form-control"
                          rows="4" placeholder="물품의 외관, 색상, 브랜드, 특징(마킹/기스/키링 등)을 자세히 적어주세요."></textarea>
            </div>

            <div style="text-align: center; padding: 1rem 0;">
                <button type="submit" class="btn" style="padding: 15px 40px; font-size: 16px;">
                    <span id="submit-text">정보 제출</span>
                </button>
            </div>
        </form>
    </div>

    <!-- 안내 카드 -->
    <div class="card" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); border: none;">
        <h3 style="color: #2c3e50; margin-bottom: 1rem; text-align: center;">📌 안내</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
            <div style="background: rgba(255,255,255,0.7); padding: 1rem; border-radius: 10px;">
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">🔍 분실 신고</h4>
                <p style="color: #555; font-size: 0.9rem;">
                    색상, 브랜드, 특징(스크래치/스티커/키링 등)을 가능한 자세히 적어 주세요. 회수 확률이 높아집니다.
                </p>
            </div>
            <div style="background: rgba(255,255,255,0.7); padding: 1rem; border-radius: 10px;">
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">📦 습득 신고</h4>
                <p style="color: #555; font-size: 0.9rem;">
                    습득한 물품 정보를 사실대로 입력하고 안전하게 보관해 주세요. 따뜻한 마음 감사합니다.
                </p>
            </div>
            <div style="background: rgba(255,255,255,0.7); padding: 1rem; border-radius: 10px;">
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">📞 연락처</h4>
                <p style="color: #555; font-size: 0.9rem;">
                    카톡/이메일/전화번호 등 연락 가능한 정보를 남겨 주세요. 개인정보는 안전하게 보호됩니다.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // 오늘 날짜 기본값 설정
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;
        document.getElementById('date').max = today;
    });

    // 상단 안내 타이틀/버튼/라벨 동기화
    function updateFormTitle() {
        const itemType = document.querySelector('input[name="item_type"]:checked').value;
        const formTitle = document.getElementById('form-title');
        const titleText = document.getElementById('title-text');
        const submitText = document.getElementById('submit-text');
        const dateLabel = document.getElementById('date-label');

        formTitle.style.display = 'block';

        if (itemType === 'lost') {
            titleText.textContent = '🔍 분실물 정보 등록';
            submitText.textContent = '분실 신고 제출';
            dateLabel.textContent = '분실 날짜 *';
        } else {
            titleText.textContent = '📦 습득물 정보 등록';
            submitText.textContent = '습득 신고 제출';
            dateLabel.textContent = '습득 날짜 *';
        }
    }

    // 폼 검증 강화
    document.querySelector('form').addEventListener('submit', function(e) {
        const requiredFields = ['item_type', 'name', 'category', 'place', 'date'];
        let isValid = true;

        requiredFields.forEach(field => {
            const input = document.querySelector(`[name="${field}"]`);
            if (field === 'item_type') {
                if (!document.querySelector('input[name="item_type"]:checked')) {
                    isValid = false;
                    alert('물품 상태(분실/습득)를 선택해 주세요.');
                }
            } else if (!input.value.trim()) {
                isValid = false;
                input.style.borderColor = '#dc3545';
                input.addEventListener('input', function() {
                    this.style.borderColor = '#e3e8f0';
                });
            }
        });

        if (!isValid) {
            e.preventDefault();
            return false;
        }
    });

    // 라디오 선택 시 카드 스타일 상호작용
    document.querySelectorAll('input[name="item_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('label').forEach(label => {
                if (label.querySelector('input[name="item_type"]')) {
                    if (label.querySelector('input').checked) {
                        label.style.borderColor = '#667eea';
                        label.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
                    } else {
                        label.style.borderColor = '#e3e8f0';
                        label.style.backgroundColor = 'transparent';
                    }
                }
            });
        });
    });
</script>
{% endblock %}
